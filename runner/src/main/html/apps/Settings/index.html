<!DOCTYPE html>
<html>
<script>
    function getLanguages() {
        parent.makeRESTRequest("/settings/languages", function (responseText) {
            var info = JSON.parse(responseText);
            var languages = info["languages"];
            var selectedLanguage = info["selected"];
            Object.keys(languages).forEach(function (item) {
                var option = document.createElement("option");
                option.value = item;
                option.innerHTML = languages[item];

                if (selectedLanguage === item) {
                    option.selected = "selected";
                }

                document.getElementById("languages").appendChild(option);
            });
        });
    }

    function changePassword() {
        if (document.getElementById("newPassword").value !== document.getElementById("confirmNewPassword").value) {
            document.getElementById("passwordChangeMessage").innerHTML = "{{changePasswordFailed}}"
        }
        else {
            parent.makeRESTRequestWithData("/settings/password", "application/x-www-form-urlencoded",
                    "oldPassword=" + document.getElementById("oldPassword").value + "&newPassword=" + document.getElementById("newPassword").value,
                    function (responseText) {
                        document.getElementById("passwordChangeMessage").innerHTML = "{{changePasswordSucceeded}}"
                    }, function () {
                        document.getElementById("passwordChangeMessage").innerHTML = "{{changePasswordFailed}}"
                    }
            );
        }
        clearChangePasswordFields();
    }

    function clearChangePasswordFields() {
        document.getElementById("oldPassword").value = "";
        document.getElementById("newPassword").value = "";
        document.getElementById("confirmNewPassword").value = "";
    }

    function setLanguage(language) {
        parent.makeRESTRequestWithData("/settings/language", "application/x-www-form-urlencoded", "language=" + language,
                function (responseText) {
                    parent.location.reload();
                }
        );
    }
</script>
<body onLoad="getLanguages()">
<label for="languages">{{changeLanguage}}</label><select id="languages"
                                                         onChange="setLanguage(this.options[this.selectedIndex].value)"></select><br/><br/>

<span id="passwordChangeMessage"></span><br/>
<label for="oldPassword">{{oldPasswordLabel}}</label><input type="password" id="oldPassword"/><br/>
<label for="newPassword">{{newPasswordLabel}}</label><input type="password" id="newPassword"/><br/>
<label for="confirmNewPassword">{{confirmNewPasswordLabel}}</label><input type="password" id="confirmNewPassword"/><br/>
<button type="button" onclick="changePassword()">{{changePassword}}</button>

</body>
</html>
