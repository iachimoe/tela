<!DOCTYPE html>
<html>
<script>
    function allowDrop(event) {
        event.preventDefault();
    }

    function drop(event) {
        event.preventDefault();
        handleDropToDownloadProfile(event.dataTransfer.getData("text"));
    }

    function handleTouchDrop(item) {
        handleDropToDownloadProfile(item);
    }

    function handleDropToDownloadProfile(user) {
        downloadProfileInfo(user, user);
    }

    function downloadOwnProfile() {
        downloadProfileInfo(null, "{{myProfileUserLabel}}");
    }

    function downloadProfileInfo(user, profileUserLabel) {
        parent.makeRESTRequest(getUrlForProfileInfo(user), function (responseText) {
            populateUserInfo(JSON.parse(responseText)[0], profileUserLabel);
        });
    }

    function populateUserInfo(info, profileUserLabel) {
        document.getElementById("profileUserLabel").innerHTML = profileUserLabel;

        var fields = ["name", "jobTitle", "email", "telephone", "description"];

        for (var i = 0; i < fields.length; i++) {
            populateField(fields[i], info);
        }
    }

    function populateField(field, data) {
        var SCHEMA_ROOT = "http://schema.org/";

        if (data != null && data[SCHEMA_ROOT + field]) {
            document.getElementById(field).innerHTML = parent.getValueOfJsonLdField(data, SCHEMA_ROOT + field);
        }
        else {
            document.getElementById(field).innerHTML = "";
        }
    }

    function getUrlForProfileInfo(user) {
        var PROFILE_URN = "urn:tela:personalDetails";
        var url = "/data?uri=" + encodeURIComponent(PROFILE_URN);
        if (user != null) {
            url += "&publisher=" + encodeURIComponent(user);
        }
        return url;
    }
</script>
<body ondrop="drop(event)" ondragover="allowDrop(event)" onload="downloadOwnProfile()">
<span id="profileUserLabel"></span><br />
{{nameLabel}} <span id="name"></span><br/>
{{jobTitleLabel}} <span id="jobTitle"></span><br/>
{{emailLabel}} <span id="email"></span><br/>
{{telephoneLabel}} <span id="telephone"></span><br/>
{{descriptionLabel}} <span id="description"></span><br/>
</body>
</html>
